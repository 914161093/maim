import{s as e,g as t,r as a,a as o,x as n,o as s,c as l,w as i,h as c,i as d,f as h,j as p,y as r,z as u,v as g,q as m,t as f,I as _,A as x,u as w,B as C}from"./index-2552b00d.js";import{r as k,_ as y}from"./uni-app.es.b762ced6.js";import{_ as T}from"./_plugin-vue_export-helper.1b428a4d.js";const b=""+new URL("login_bg-29094466.png",import.meta.url).href;const v=T({data:()=>({phone:"",pwd:"",second:60,interval:null,showText:!0,code:"",isCode:!1,isAgree:!1,showTip:!1}),onShow(){const n=window.location.href,s=/[?&]channel(?:=([^&#]*)|&|#|$)/.exec(n),l=s&&s[1]?decodeURIComponent(s[1].replace(/\+/g," ")):null;e("channel",l),""==t("token")?async function(){try{var t=await a({url:"https://api.maimangbox.cn/getToken",header:{"content-type":"application/json"},data:{platform:3,channel:l},method:"POST"});1e4==t.data.resultCode?(console.log("10000"),e("token",t.data.data),a({url:"https://api.maimangbox.cn/login/page",data:{},header:{"content-type":"application/json","api-token":t.data.data},method:"POST",success:e=>{console.log(e),2==e.data.data.isCode&&(this.isCode=!0)}})):(console.log(t),e("token",""),c(),o({title:t.data.resultMsg,icon:"none"}))}catch(n){console.error(n)}}():a({url:"https://api.maimangbox.cn/login/page",data:{},header:{"content-type":"application/json","api-token":t("token")},method:"POST",success:e=>{console.log(e),2==e.data.data.isCode&&(this.isCode=!0)}})},methods:{agreeChange(e){this.isAgree=e},startCountdown(){let e=this;e.interval=setInterval((()=>{this.second--,0===e.second&&(clearInterval(e.interval),this.showText=!0,this.second=60)}),1e3)},login(){const s=window.location.href,l=/[?&]next(?:=([^&#]*)|&|#|$)/.exec(s);l&&l[1]&&decodeURIComponent(l[1].replace(/\+/g," "));this.phone?/^[1][3,4,5,7,8,9][0-9]{9}$/.test(this.phone)?this.isCode&&""==this.code?o({title:"请输入验证码",icon:"none"}):1==this.isAgree?a({url:"https://api.maimangbox.cn/login",data:{phone:this.phone,code:this.code,next:"login"},header:{"content-type":"application/json","api-token":t("token")},method:"POST",success:a=>{1e4==a.data.resultCode?(o({title:"登录成功！",icon:"none"}),console.log(a.data.data),e("token",a.data.data),console.log(t("token")),n()):o({title:a.data.resultMsg,icon:"none"})}}):o({title:"请勾选用户协议和隐私协议",icon:"none"}):o({title:"请输入正确手机号",icon:"none"}):o({title:"请输入您的手机号",icon:"none"})},getCode(){this.phone?/^[1][3,4,5,7,8,9][0-9]{9}$/.test(this.phone)?(t("token"),a({url:"https://api.maimangbox.cn/sendMsg",data:{phone:this.phone},header:{"content-type":"application/json","api-token":t("token")},method:"POST",success:e=>{o({title:e.data.resultMsg,icon:"none"}),1e4==e.data.resultCode&&(this.showText=!1,this.startCountdown())}})):o({title:"请输入正确手机号",icon:"none"}):o({title:"请输入您的手机号",icon:"none"})}}},[["render",function(e,t,a,o,n,c){const T=m,v=d,j=f,A=_,I=k(x("agree"),y),S=w,V=C;return s(),l(v,{class:"container"},{default:i((()=>[h(v,{class:"img-a"},{default:i((()=>[h(v,{class:"t-b"},{default:i((()=>[h(T,{src:b,class:"logo",mode:"widthFix"}),h(v,null,{default:i((()=>[h(v,{class:"title"},{default:i((()=>[p("智能管家服务")])),_:1}),h(v,{class:"subtitle"},{default:i((()=>[p("麦麦")])),_:1})])),_:1})])),_:1})])),_:1}),h(v,{class:"login-view",style:{}},{default:i((()=>[h(v,{class:"t-login"},{default:i((()=>[h(V,{class:"cl"},{default:i((()=>[h(v,{class:"t-a"},{default:i((()=>[h(j,{class:"txt"},{default:i((()=>[p("手机号")])),_:1}),h(A,{type:"number",name:"phone",placeholder:"请输入您的手机号",maxlength:"11",modelValue:n.phone,"onUpdate:modelValue":t[0]||(t[0]=e=>n.phone=e)},null,8,["modelValue"])])),_:1}),r(h(v,{class:"t-a"},{default:i((()=>[h(j,{class:"txt"},{default:i((()=>[p("验证码")])),_:1}),h(A,{type:"number",name:"code",maxlength:"18",placeholder:"请输入您的密码",modelValue:n.code,"onUpdate:modelValue":t[1]||(t[1]=e=>n.code=e)},null,8,["modelValue"]),n.showText?(s(),l(v,{key:0,class:"t-c",onClick:t[2]||(t[2]=e=>c.getCode())},{default:i((()=>[p("发送验证码")])),_:1})):(s(),l(v,{key:1,class:"t-c",style:{"background-color":"#A7A7A7"}},{default:i((()=>[p("重新发送("+g(n.second)+")",1)])),_:1}))])),_:1},512),[[u,n.isCode]]),h(v,{class:"t-a"},{default:i((()=>[h(I,{onIsAgree:c.agreeChange,showTip:n.showTip},null,8,["onIsAgree","showTip"])])),_:1}),h(S,{onClick:t[3]||(t[3]=e=>c.login()),class:"login_btn"},{default:i((()=>[p("登 录")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-41f43cf9"]]);export{v as default};
